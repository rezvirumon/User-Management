<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">

<div class="container mx-auto p-8">
    <h1 class="text-2xl font-bold mb-4">User Management</h1>

    <!-- Search and Filter Form -->
    <form id="searchFilterForm" class="mb-4 flex items-center space-x-4">
        <input type="text" id="searchUser" class="p-2 border border-gray-300" placeholder="Search by Name" oninput="searchUsers()">
        
        <div class="relative inline-block text-left">
            <select id="packageFilter" class="p-2 border border-gray-300" onchange="filterUsers()">
                <option value="all" selected>Show All Packages</option>
                <option value="8Mbps">8Mbps</option>
                <option value="10Mbps">10Mbps</option>
                <option value="12Mbps">12Mbps</option>
                <option value="15Mbps">15Mbps</option>
                <option value="20Mbps">20Mbps</option>
            </select>
        </div>
    </form>

    <!-- User List -->
    <div id="userList" class="mb-8">
        <!-- User cards will be added here dynamically -->
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-md">
            <h2 class="text-2xl font-bold mb-4">Add User</h2>
            <form id="addUserForm" class="flex flex-col">
                <input type="text" id="name" class="p-2 mb-2" placeholder="Enter Name">
                <input type="text" id="ipAddress" class="p-2 mb-2" placeholder="Enter IP Address">
                <input type="text" id="mobileNumber" class="p-2 mb-2" placeholder="Enter Mobile Number">
                <div class="relative inline-block text-left mb-2">
                    <select id="package" class="p-2" onchange="updatePayAmount()">
                        <option value="" disabled selected>Select Package</option>
                        <option value="8Mbps">8Mbps</option>
                        <option value="10Mbps">10Mbps</option>
                        <option value="12Mbps">12Mbps</option>
                        <option value="15Mbps">15Mbps</option>
                        <option value="20Mbps">20Mbps</option>
                    </select>
                </div>
                <input type="number" id="payAmount" class="p-2 mb-2" placeholder="Monthly Pay Amount" readonly>
                <input type="number" id="dueAmount" class="p-2 mb-2" placeholder="Enter Due Amount">
                <button type="button" onclick="addUser()" class="bg-blue-500 text-white p-2 rounded-md">Add User</button>
                <button type="button" onclick="closeAddUserModal()" class="bg-red-500 text-white p-2 rounded-md mt-2">Close</button>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-md">
            <p class="text-xl font-bold mb-4">Are you sure you want to delete this user?</p>
            <div class="flex justify-end">
                <button type="button" onclick="confirmDelete(true)" class="bg-red-500 text-white p-2 rounded-md">Yes</button>
                <button type="button" onclick="confirmDelete(false)" class="bg-green-500 text-white p-2 rounded-md ml-2">No</button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-md">
            <h2 class="text-2xl font-bold mb-4">Edit User</h2>
            <form id="editUserForm" class="flex flex-col">
                <input type="hidden" id="editUserId">
                <input type="text" id="editName" class="p-2 mb-2" placeholder="Enter Name">
                <input type="text" id="editIpAddress" class="p-2 mb-2" placeholder="Enter IP Address">
                <input type="text" id="editMobileNumber" class="p-2 mb-2" placeholder="Enter Mobile Number">
                <div class="relative inline-block text-left mb-2">
                    <select id="editPackage" class="p-2" onchange="updateEditPayAmount()">
                        <option value="" disabled selected>Select Package</option>
                        <option value="8Mbps">8Mbps</option>
                        <option value="10Mbps">10Mbps</option>
                        <option value="12Mbps">12Mbps</option>
                        <option value="15Mbps">15Mbps</option>
                        <option value="20Mbps">20Mbps</option>
                    </select>
                </div>
                <input type="number" id="editPayAmount" class="p-2 mb-2" placeholder="Monthly Pay Amount" readonly>
                <input type="number" id="editDueAmount" class="p-2 mb-2" placeholder="Enter Due Amount">
                <button type="button" onclick="updateUser()" class="bg-green-500 text-white p-2 rounded-md">Update User</button>
                <button type="button" onclick="closeEditUserModal()" class="bg-red-500 text-white p-2 rounded-md mt-2">Close</button>
            </form>
        </div>
    </div>

    <!-- Total Pay and Due Amounts -->
    <div class="mt-8">
        <h2 class="text-xl font-bold mb-2">Total Pay Amount: $<span id="totalPayAmount">0</span></h2>
        <h2 class="text-xl font-bold mb-2">Total Due Amount: $<span id="totalDueAmount">0</span></h2>
        <h2 class="text-xl font-bold mb-2">Total Users: <span id="totalUserCount">0</span></h2>
    </div>
    
    <!-- Add User Button -->
    <button type="button" onclick="openAddUserModal()" class="bg-green-500 text-white p-2 rounded-md mt-4">Add User</button>
</div>

<script>
    const userList = document.getElementById('userList');
    const nameInput = document.getElementById('name');
    const ipAddressInput = document.getElementById('ipAddress');
    const mobileNumberInput = document.getElementById('mobileNumber');
    const packageInput = document.getElementById('package');
    const payAmountInput = document.getElementById('payAmount');
    const dueAmountInput = document.getElementById('dueAmount');
    const searchUserInput = document.getElementById('searchUser');
    const packageFilterInput = document.getElementById('packageFilter');
    
    const addUserModal = document.getElementById('addUserModal');
    const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
    const editUserModal = document.getElementById('editUserModal');
    const addUserForm = document.getElementById('addUserForm');
    const addPackageInput = document.getElementById('addPackage');
    
    const editUserIdInput = document.getElementById('editUserId');
    const editNameInput = document.getElementById('editName');
    const editIpAddressInput = document.getElementById('editIpAddress');
    const editMobileNumberInput = document.getElementById('editMobileNumber');
    const editPackageInput = document.getElementById('editPackage');
    const editPayAmountInput = document.getElementById('editPayAmount');
    const editDueAmountInput = document.getElementById('editDueAmount');

    const totalPayAmountElement = document.getElementById('totalPayAmount');
    const totalDueAmountElement = document.getElementById('totalDueAmount');
    const totalUserCountElement = document.getElementById('totalUserCount');

    // Predefined monthly bill values for each package
    const packageMonthlyBill = {
        '8Mbps': 500,
        '10Mbps': 600,
        '12Mbps': 700,
        '15Mbps': 800,
        '20Mbps': 1000,
    };

    // Dummy data for initial users
    const users = [
        { id: 1, name: 'John Doe', ipAddress: '192.168.1.1', mobileNumber: '1234567890', package: '8Mbps', payAmount: 500, dueAmount: 10 },
        { id: 2, name: 'Jane Doe', ipAddress: '192.168.1.2', mobileNumber: '9876543210', package: '10Mbps', payAmount: 600, dueAmount: 5 },
    ];

    // Function to render users
    function renderUsers(filteredUsers = users) {
        userList.innerHTML = '';
        let totalPayAmount = 0;
        let totalDueAmount = 0;

        filteredUsers.forEach(user => {
            totalPayAmount += user.payAmount;
            totalDueAmount += user.dueAmount;

            const card = document.createElement('div');
            card.className = 'bg-white p-4 mb-2 flex flex-col justify-between items-center md:items-start';
            card.innerHTML = `
                <div>
                    <p><strong>Name:</strong> ${user.name}</p>
                    <p><strong>IP Address:</strong> ${user.ipAddress}</p>
                    <p><strong>Mobile Number:</strong> ${user.mobileNumber}</p>
                    <p><strong>Package:</strong> ${user.package}</p>
                    <p><strong>Pay Amount:</strong> $${user.payAmount}</p>
                    <p><strong>Due Amount:</strong> $${user.dueAmount}</p>
                </div>
                <div class="flex items-center mt-2 md:mt-0">
                    <button onclick="openEditUserModal(${user.id})" class="bg-yellow-500 text-white p-2 rounded-l-md">Edit</button>
                    <button onclick="openDeleteConfirmationModal(${user.id})" class="bg-red-500 text-white p-2 rounded-r-md md:rounded-l-md ml-2">Delete</button>
                </div>
            `;
            userList.appendChild(card);
        });

        // Update total Pay and Due Amounts
        totalPayAmountElement.textContent = totalPayAmount.toFixed(2);
        totalDueAmountElement.textContent = totalDueAmount.toFixed(2);

        // Update total user count
        totalUserCountElement.textContent = filteredUsers.length;
    }

    // Function to add a new user
    function addUser() {
        const name = nameInput.value.trim();
        const ipAddress = ipAddressInput.value.trim();
        const mobileNumber = mobileNumberInput.value.trim();
        const packageValue = packageInput.value.trim();
        const dueAmount = parseFloat(dueAmountInput.value) || 0;

        // Use predefined monthly bill value for the selected package
        const payAmount = packageValue ? packageMonthlyBill[packageValue] || 0 : 0;

        if (name && ipAddress && mobileNumber && packageValue && !isNaN(dueAmount)) {
            const newUser = { 
                id: Date.now(), 
                name, 
                ipAddress, 
                mobileNumber, 
                package: packageValue, 
                payAmount, 
                dueAmount 
            };
            users.push(newUser);
            renderUsers();
            
            // Clear input fields
            nameInput.value = '';
            ipAddressInput.value = '';
            mobileNumberInput.value = '';
            packageInput.value = '';
            payAmountInput.value = '';
            dueAmountInput.value = '';

            // Close the add user modal
            closeAddUserModal();
        }
    }

    // Function to update Pay Amount based on the selected package
    function updatePayAmount() {
        const packageValue = packageInput.value.trim();
        payAmountInput.value = packageValue ? packageMonthlyBill[packageValue] || '' : '';
    }

    // Function to open the add user modal
    function openAddUserModal() {
        // Show the add user modal
        addUserModal.classList.remove('hidden');
    }

    // Function to close the add user modal
    function closeAddUserModal() {
        // Clear input fields
        nameInput.value = '';
        ipAddressInput.value = '';
        mobileNumberInput.value = '';
        packageInput.value = '';
        payAmountInput.value = '';
        dueAmountInput.value = '';

        // Hide the add user modal
        addUserModal.classList.add('hidden');
    }

    // Function to open the delete confirmation modal
    function openDeleteConfirmationModal(userId) {
        // Set the current user ID to be deleted
        deleteConfirmationModal.dataset.userId = userId;
        // Show the delete confirmation modal
        deleteConfirmationModal.classList.remove('hidden');
    }

    // Function to close the delete confirmation modal
    function closeDeleteConfirmationModal() {
        // Hide the delete confirmation modal
        deleteConfirmationModal.classList.add('hidden');
    }

    // Function to confirm or cancel the delete operation
    function confirmDelete(isConfirmed) {
        const userId = parseInt(deleteConfirmationModal.dataset.userId);

        if (isConfirmed && !isNaN(userId)) {
            // Delete the user
            deleteUser(userId);
        }

        // Close the delete confirmation modal
        closeDeleteConfirmationModal();
    }

    // Function to open the edit user modal
    function openEditUserModal(userId) {
        const userToEdit = users.find(user => user.id === userId);

        if (userToEdit) {
            editUserIdInput.value = userToEdit.id;
            editNameInput.value = userToEdit.name;
            editIpAddressInput.value = userToEdit.ipAddress;
            editMobileNumberInput.value = userToEdit.mobileNumber;
            editPackageInput.value = userToEdit.package;
            editPayAmountInput.value = userToEdit.payAmount;
            editDueAmountInput.value = userToEdit.dueAmount;

            // Show the edit user modal
            editUserModal.classList.remove('hidden');
        }
    }

    // Function to update Edit Pay Amount based on the selected package in the edit modal
    function updateEditPayAmount() {
        const packageValue = editPackageInput.value.trim();
        editPayAmountInput.value = packageValue ? packageMonthlyBill[packageValue] || '' : '';
    }

    // Function to close the edit user modal
    function closeEditUserModal() {
        // Clear input fields
        editUserIdInput.value = '';
        editNameInput.value = '';
        editIpAddressInput.value = '';
        editMobileNumberInput.value = '';
        editPackageInput.value = '';
        editPayAmountInput.value = '';
        editDueAmountInput.value = '';

        // Hide the edit user modal
        editUserModal.classList.add('hidden');
    }

    // Function to update a user
    function updateUser() {
        const userId = parseInt(editUserIdInput.value);
        const name = editNameInput.value.trim();
        const ipAddress = editIpAddressInput.value.trim();
        const mobileNumber = editMobileNumberInput.value.trim();
        const packageValue = editPackageInput.value.trim();
        const payAmount = parseFloat(editPayAmountInput.value) || 0;
        const dueAmount = parseFloat(editDueAmountInput.value) || 0;

        if (userId && name && ipAddress && mobileNumber && packageValue && !isNaN(dueAmount)) {
            const index = users.findIndex(user => user.id === userId);

            if (index !== -1) {
                const updatedUser = {
                    id: userId,
                    name,
                    ipAddress,
                    mobileNumber,
                    package: packageValue,
                    payAmount,
                    dueAmount
                };

                // Update the user in the array
                users[index] = updatedUser;

                // Render the updated user list
                renderUsers();

                // Close the edit user modal
                closeEditUserModal();
            }
        }
    }

    // Function to delete a user
    function deleteUser(userId) {
        const index = users.findIndex(user => user.id === userId);
        if (index !== -1) {
            users.splice(index, 1);
            renderUsers();
        }
    }

    // Function to search users by name
    function searchUsers() {
        const searchTerm = searchUserInput.value.trim().toLowerCase();
        const filteredUsers = users.filter(user => user.name.toLowerCase().includes(searchTerm));
        renderUsers(filteredUsers);
    }

    // Function to filter users by package
    function filterUsers() {
        const selectedPackage = packageFilterInput.value;
        if (selectedPackage === 'all') {
            renderUsers(users);
        } else {
            const filteredUsers = users.filter(user => user.package === selectedPackage);
            renderUsers(filteredUsers);
        }
    }

    // Initial rendering
    renderUsers();
</script>

</body>
</html>
